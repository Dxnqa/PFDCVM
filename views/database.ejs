<%- include("partials/header.ejs") %>

<div class="container my-4">
  <h3 class="mb-3">Database View</h3>
  <form action="export" method="POST">
    <button class="btn btn-success mb-3 rounded-3" type="submit">Export CSV</button>
  </form>
  <div class="table-responsive border border-4 border-dark py-1" style="max-height:60vh;">
    <table class="table table-sm table-striped table-hover align-middle">
      <thead class="table-light" style="position: sticky; top: 0; z-index: 1;">
        <tr>
          <th style="width:6rem;">Id</th>
          <th style="min-width:12rem;">Name</th>
          <th style="min-width:10rem;">Category</th>
          <th style="min-width:10rem;">Resolution</th>
          <th class="d-none d-sm-table-cell" style="min-width:16rem;">Notes</th>
        </tr>
      </thead>
      <tbody>
        <% if (entries.length === 0) { %>
          <tr>
            <td colspan="5" class="text-muted">No entries yet.</td>
          </tr>
        <% } %>

        <% entries.forEach(r => { %>
          <tr>
            <td class="font-monospace"><%= r.id %></td>
            <td><%= r.name %></td>
            <td><%= r.category %></td>
            <td>
              <% const badge =
                   String(r.resolution).toLowerCase() === 'resolved'
                   ? 'bg-success'
                   : String(r.resolution).toLowerCase() === 'open'
                     ? 'bg-warning text-dark'
                     : 'bg-secondary'; %>
              <span class="badge <%= badge %>"><%= r.resolution %></span>
            </td>
            <td class="d-none d-sm-table-cell">
              <span class="d-inline-block text-truncate"
                    style="max-width:28ch;"
                    data-bs-toggle="tooltip"
                    data-bs-title="<%= (r.notes || '').replace(/"/g, '&quot;') %>">
                <%= r.notes %>
              </span>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>
